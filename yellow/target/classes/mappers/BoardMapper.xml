<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yellow.persistence.BoardDAO">
		<select id="newBoardList" resultType="BoardDTO">
			<include refid="paging_header"/><!-- include페이지헤더니까 페이지헤더가 먼저 나오라는 말 -->
			SELECT bno, title, writer, name, updatedate, viewcnt, replycnt, goodcnt, show
			FROM tbl_board b, tbl_member m		
			<include refid="search"/>
			<if test="map.sort_option == 'new'">
				ORDER By b.bno DESC				
			</if>
			<if test="map.sort_option == 'cnt'">
				ORDER By b.viewcnt DESC				
			</if>
			<if test="map.sort_option == 'reply'">
				ORDER By b.replycnt DESC				
			</if>
			<if test="map.sort_option == 'good'">
				ORDER By b.goodcnt DESC				
			</if>
			<include refid="paging_footer"/>
		</select>
		
		
		
		<sql id="paging_header">
			SELECT *
			FROM(
				SELECT rownum AS rnum, A.*
				FROM(
		</sql>	
		<sql id="paging_footer">
				)A
			)WHERE rnum BETWEEN #{map.start} AND #{map.end}	
		</sql>
		
		
		
		
		
		<select id="countArticle" resultType="Integer">
			SELECT COUNT(*)
			FROM tbl_board b, tbl_member m
			<include refid="search"/>
		</select>
		
		<sql id="search">
			<choose>
				<when test="map.search_option !='all'">
					WHERE b.writer = m.id
						AND b.show = 'Y'
						AND #{map.search_option} LIKE #{map.keyword}
				</when>
				<otherwise>
					WHERE b.writer = m.id
						AND b.show = 'Y'
						AND(title LIKE #{map.keyword}
							OR content LIKE #{map.keyword}
							OR id LIKE #{map.keyword})
				</otherwise>
			</choose>
		</sql>
		
		<select id="viewBoard" resultType = "BoardDTO">
			SELECT * FROM tbl_board
			WHERE bno = #{bno}
		</select>
</mapper>